---
import { getCollection, getEntry } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import ItemCollectionLayout from '~/layouts/ItemCollectionLayout.astro';

const workshopCollection = await getCollection('workshops')

async function collectData() {
  const newData = 
    workshopCollection.sort((a: CollectionEntry<'workshops'>, b: CollectionEntry<'workshops'>) => {
        const dateA = new Date(a.data.start).getTime();
        const dateB = new Date(b.data.start).getTime();

        return dateB - dateA;  // Sorts in descending order to get the latest first
      })
      .map(async (entry: CollectionEntry<'workshops'>) => {
        const { Content } = await entry.render();
        return {
          id: entry.id,
          slug: entry.slug,
          publishDate: entry.data.start,
          title: entry.data.title,
          permalink: "/workshops/" + entry.slug,
          content: Content,
          excerpt: entry.data.excerpt,
          image: entry.data.location.image,
        }
      })
  return await Promise.all(newData)
} 

const data = await collectData();
---

<ItemCollectionLayout data={data} collectionName="Workshops" />